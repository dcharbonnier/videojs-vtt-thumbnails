/**
 * videojs-vtt-thumbnails
 * @version 0.0.3
 * @copyright 2018 Chris Boustead <chris@forgemotion.com>
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):t.videojsVttThumbnails=e(t.videojs)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e,i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o="undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:{},n={},s=Object.freeze({default:n}),r=s&&n||s,a=void 0!==i?i:"undefined"!=typeof window?window:{};"undefined"!=typeof document?e=document:(e=a["__GLOBAL_DOCUMENT_CACHE@4"])||(e=a["__GLOBAL_DOCUMENT_CACHE@4"]=r);var u=e,l=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},p={},h=t.registerPlugin||t.plugin,d=function(){function e(t,i){return l(this,e),this.player=t,this.options=i,this.initializeThumbnails(),this}return e.prototype.src=function(t){this.resetPlugin(),this.options.src=t,this.initializeThumbnails()},e.prototype.detach=function(){this.resetPlugin()},e.prototype.resetPlugin=function(){var t=this;this.progressBar.removeEventListener("mouseenter",function(){return t.onBarMouseEnter()}),this.progressBar.removeEventListener("mouseleave",function(){return t.onBarMouseLeave()}),this.progressBar.removeEventListener("mousemove",this.onBarMouseMove),delete this.progressBar,delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle},e.prototype.initializeThumbnails=function(){var t=this;if(this.options.src){var e=this.getBaseUrl(),i=this.getFullyQualifiedUrl(this.options.src,e);this.getVttFile(i).then(function(e){t.vttData=t.processVtt(e),t.setupThumbnailElement()})}},e.prototype.getBaseUrl=function(){return[o.location.protocol,"//",o.location.hostname,o.location.port?":"+o.location.port:"",o.location.pathname].join("").split(/([^\/]*)$/gi).shift()},e.prototype.getVttFile=function(e){return new Promise(function(i,o){t.xhr(e,function(t,e,o){i(t?null:o)})})},e.prototype.setupThumbnailElement=function(t){var e=this,i=this.player.$(".vjs-mouse-display"),o=u.createElement("div");o.setAttribute("class","vjs-vtt-thumbnail-display"),this.progressBar=this.player.$(".vjs-progress-control"),this.progressBar.appendChild(o),this.thumbnailHolder=o,i.classList.add("vjs-hidden"),this.progressBar.addEventListener("mouseenter",function(){return e.onBarMouseEnter()}),this.progressBar.addEventListener("mouseleave",function(){return e.onBarMouseLeave()})},e.prototype.onBarMouseEnter=function(){var t=this;this.mouseMoveCallback=function(e){t.onBarMouseMove(e)},this.progressBar.addEventListener("mousemove",this.mouseMoveCallback),this.showThumbnailHolder()},e.prototype.onBarMouseLeave=function(){this.progressBar.removeEventListener("mousemove",this.mouseMoveCallback),this.hideThumbnailHolder()},e.prototype.onBarMouseMove=function(e){this.updateThumbnailStyle(t.dom.getPointerPosition(this.progressBar,e).x,this.progressBar.offsetWidth)},e.prototype.getStyleForTime=function(t){for(var e=0;e<this.vttData.length;++e){var i=this.vttData[e];if(t>=i.start&&t<i.end)return i.css}},e.prototype.showThumbnailHolder=function(){this.thumbnailHolder.style.opacity="1"},e.prototype.hideThumbnailHolder=function(){this.thumbnailHolder.style.opacity="0"},e.prototype.updateThumbnailStyle=function(t,e){var i=t*this.player.duration(),o=this.getStyleForTime(i);if(!o)return this.hideThumbnailHolder();var n=t*e;if(this.thumbnailHolder.style.transform="translateX("+n+"px)",this.thumbnailHolder.style.marginLeft="-"+parseInt(o.width,10)/2+"px",!this.lastStyle||this.lastStyle!==o){this.lastStyle=o;for(var s in o)o.hasOwnProperty(s)&&(this.thumbnailHolder.style[s]=o[s])}},e.prototype.processVtt=function(t){var e=this,i=[];return t.split(/[\r\n][\r\n]/i).forEach(function(t){if(t.match(new RegExp("([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--\x3e ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*","gi"))){var o=t.split(/[\r\n]/i),n=o[0].split(/ ?--> ?/i),s=n[0],r=n[1],a=o[1],u=e.getVttCss(a);i.push({start:e.getSecondsFromTimestamp(s),end:e.getSecondsFromTimestamp(r),css:u})}}),i},e.prototype.getFullyQualifiedUrl=function(t,e){return t.indexOf("//")>=0?t:0===e.indexOf("//")?[e.replace(/\/$/gi,""),this.trim(t,"/")].join("/"):e.indexOf("//")>0?[this.trim(e,"/"),this.trim(t,"/")].join("/"):t},e.prototype.getPropsFromDef=function(t){var e=t.split(/#xywh=/i),i=e[0],o=e[1].match(/[0-9]+/gi);return{x:o[0],y:o[1],w:o[2],h:o[3],image:i}},e.prototype.getVttCss=function(t){var e={},i=void 0;if(i=this.options.src.indexOf("//")>=0?this.options.src.split(/([^\/]*)$/gi).shift():this.getBaseUrl()+this.options.src.split(/([^\/]*)$/gi).shift(),!(t=this.getFullyQualifiedUrl(t,i)).match(/#xywh=/i))return e.background='url("'+t+'")',e;var o=this.getPropsFromDef(t);return e.background='url("'+o.image+'") no-repeat -'+o.x+"px -"+o.y+"px",e.width=o.w+"px",e.height=o.h+"px",e},e.prototype.doconstructTimestamp=function(t){var e=t.split("."),i=e[0].split(":");return{milliseconds:parseInt(e[1],10)||0,seconds:parseInt(i.pop(),10)||0,minutes:parseInt(i.pop(),10)||0,hours:parseInt(i.pop(),10)||0}},e.prototype.getSecondsFromTimestamp=function(t){var e=this.doconstructTimestamp(t);return Math.floor(3600*e.hours+60*e.minutes+e.seconds+e.milliseconds/1e3)},e.prototype.trim=function(t,e){var i=[" ","\n","\r","\t","\f","\v"," "," "," "," "," "," "," "," "," "," "," "," ","​","\u2028","\u2029","　"].join(""),o=0,n=0;for(t+="",e&&(i=(e+"").replace(/([[\]().?/*{}+$^:])/g,"$1")),n=0,o=t.length;n<o;n++)if(-1===i.indexOf(t.charAt(n))){t=t.substring(n);break}for(n=(o=t.length)-1;n>=0;n--)if(-1===i.indexOf(t.charAt(n))){t=t.substring(0,n+1);break}return-1===i.indexOf(t.charAt(0))?t:""},e}(),f=function(e){var i=this;this.ready(function(){o=i,n=t.mergeOptions(p,e),o.addClass("vjs-vtt-thumbnails"),o.vttThumbnails=new d(o,n);var o,n})};return h("vttThumbnails",f),f.VERSION="0.0.3",f});